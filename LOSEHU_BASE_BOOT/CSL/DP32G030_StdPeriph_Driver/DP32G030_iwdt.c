#include "DP32G030_iwdt.h"


/****************************************************************************************************************************************** 
* 函数名称:	IWDT_Init()
* 功能说明:	IWDT看门狗初始化
* 输    入: IWDT_InitTypeDef * IWDT_InitStruct
*			
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_Init(IWDT_InitTypeDef * IWDT_InitStruct)
{
	assert_param(IS_IWDT_INT(IWDT_InitStruct->IntEn));                 //检查输入的参数IntEn是否合法      
	
	assert_param(IS_IWDT_LOAD(IWDT_InitStruct->Load));                 //检查输入的参数Load是否合法   
	
	SYS->CLKEN |= 0x01 << SYS_CLKEN_IWDT_POS;                          //IWDT时钟使能
	
	IWDT_Stop();                                                       //关闭IWDT
	
	IWDT->LOAD = IWDT_InitStruct->Load;                                //填充IWDT初始值
	
	if(IWDT_InitStruct->IntEn == DISABLE)                              //中断使能选择
	{
		IWDT->CTRL &= ~(0x01 << IWDT_CTRL_INTEN_POS);
		NVIC_DisableIRQ(IWDT_IRQn);                                    //关闭IWDT中断   
	}
	else
	{
		IWDT->CTRL |= (0x01 << IWDT_CTRL_INTEN_POS);   
        NVIC_EnableIRQ(IWDT_IRQn);                                     //开启IWDT中断		
	}
}


/****************************************************************************************************************************************** 
* 函数名称:	IWDT_Start()
* 功能说明:	启动指定IWDT，开始倒计时
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_Start(void)
{
	IWDT->CTRL |= (0x01 << IWDT_CTRL_EN_POS);
}

/****************************************************************************************************************************************** 
* 函数名称:	IWDT_Stop()
* 功能说明:	关闭指定IWDT，停止倒计时
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_Stop(void)
{
	IWDT->CTRL &= ~(0x01 << IWDT_CTRL_EN_POS);
}


/****************************************************************************************************************************************** 
* 函数名称:	IWDT_FEED()
* 功能说明:	喂狗操作
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_FEED(void)
{
	IWDT->FEED = 0x55;
}


/****************************************************************************************************************************************** 
* 函数名称:	IWDT_INT_Enable()
* 功能说明:	IWDT中断使能
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_INT_Enable(void)
{
	IWDT->CTRL |= (0x01 << IWDT_CTRL_INTEN_POS);     //中断使能
}

/****************************************************************************************************************************************** 
* 函数名称:	IWDT_INT_Disable()
* 功能说明:	IWDT中断禁能
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_INT_Disable(void)
{
	IWDT->CTRL &= ~(0x01 << IWDT_CTRL_INTEN_POS);     //中断禁能
}

/****************************************************************************************************************************************** 
* 函数名称:	IWDT_INTStat()
* 功能说明:	中断状态查询
* 输    入: 无
* 输    出: uint8_t		1 发生中断溢出    0 未发生中断溢出
* 注意事项: 无
******************************************************************************************************************************************/
uint8_t IWDT_INTStat(void)
{
	return IWDT->IF;
}


/****************************************************************************************************************************************** 
* 函数名称:	IWDT_INTClr()
* 功能说明:	中断标志清除
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IWDT_INTClr(void)
{
	IWDT->IF = 1;
}


